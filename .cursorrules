# CURSOR RULES - Há»‡ Thá»‘ng TÆ° Váº¥n Vay Vá»‘n

## Má»¤C ÄÃCH
Chuyá»ƒn Ä‘á»•i repo demo thÃ nh há»‡ thá»‘ng mÃ´i giá»›i vay vá»‘n thá»±c táº¿ cho VPBank

## QUY Táº®C Báº®T BUá»˜C

### 1. Äá»ŒC FILE NÃ€Y TRÆ¯á»šC
- `SPECIFICATION.md` - Äáº·c táº£ Ä‘áº§y Ä‘á»§
- `AUDIT_REPORT.md` - Káº¿t quáº£ rÃ  soÃ¡t

### 2. KHI GENERATE CODE

**âœ… LUÃ”N:**
- Code tiáº¿ng Anh, comment tiáº¿ng Viá»‡t
- Follow Python PEP 8
- Xá»­ lÃ½ errors Ä‘áº§y Ä‘á»§ (try/except)
- Log má»i thao tÃ¡c quan trá»ng
- Validate input tá»« user

**âŒ KHÃ”NG BAO GIá»œ:**
- Hard-code credentials
- DÃ¹ng `print()` (dÃ¹ng `logging`)
- Commit file `.env`
- Code khÃ´ng cÃ³ docstring
- DÃ¹ng `SELECT *` trong SQL

### 3. STRUCTURE

**File má»›i pháº£i á»Ÿ Ä‘Ãºng folder:**
```
backend/integrations/ â†’ Zalo OA, Google Sheets
backend/services/     â†’ OCR, MST, Form, Risk, Assignment
backend/templates/    â†’ Word templates
config/              â†’ .env, credentials
```

### 4. PHÃ‚N QUYá»€N

**5 vai trÃ²:**
- admin: ToÃ n quyá»n
- tro_ly: Xem táº¥t cáº£, phÃ¢n cÃ´ng
- nhan_vien: Chá»‰ xem Ä‘Æ°á»£c giao
- ctv: Chá»‰ xem cá»§a mÃ¬nh
- sale_ngan_hang: Chá»‰ xem chi nhÃ¡nh mÃ¬nh

**Check quyá»n:**
```python
def can_view_lead(user, lead):
    if user['role'] == 'admin': return True
    if user['role'] == 'ctv': 
        return lead['created_by'] == user['id']
    if user['role'] == 'nhan_vien':
        return lead['assigned_to'] == user['id']
    if user['role'] == 'sale_ngan_hang':
        return lead['branch'] == user['branch']
    return False
```

### 5. API RESPONSE FORMAT

```python
# Success
{
    "success": true,
    "data": {...},
    "message": "ThÃ nh cÃ´ng"
}

# Error
{
    "success": false,
    "error": "MÃ´ táº£ lá»—i",
    "code": "ERROR_CODE"
}
```

### 6. LOGGING

```python
import logging

logging.info("Lead #HS12345 Ä‘Æ°á»£c táº¡o bá»Ÿi CTV A")
logging.warning("OCR tháº¥t báº¡i cho CCCD 001234567890")
logging.error("KhÃ´ng thá»ƒ káº¿t ná»‘i Zalo OA", exc_info=True)
```

### 7. ENV VARIABLES

**KhÃ´ng bao giá» default lÃ  demo:**
```python
# âŒ SAI
ZALO_OA_ID = os.getenv('ZALO_OA_ID', 'demo_id')

# âœ… ÄÃšNG
ZALO_OA_ID = os.getenv('ZALO_OA_ID')
if not ZALO_OA_ID:
    raise ValueError("ZALO_OA_ID is required in .env")
```

### 8. DOCSTRING

```python
def extract_cccd(self, image_path):
    """
    TrÃ­ch xuáº¥t thÃ´ng tin tá»« áº£nh CCCD
    
    Args:
        image_path (str): ÄÆ°á»ng dáº«n Ä‘áº¿n file áº£nh
    
    Returns:
        dict: {
            'so_cccd': str,
            'ho_ten': str,
            'ngay_sinh': str,
            'dia_chi': str
        }
    
    Raises:
        OCRException: Náº¿u khÃ´ng Ä‘á»c Ä‘Æ°á»£c áº£nh
    """
    pass
```

### 9. LEAD MODEL

**Báº¯t buá»™c cÃ³ Ä‘á»§ fields:**
```python
{
    'id', 'created_by', 'assigned_to', 'source', 'branch',
    'ho_ten', 'so_cccd', 'phone', 'dia_chi',
    'loai_hinh', 'mst', 'loai_vay', 'so_tien_vay',
    'thoi_han', 'thu_nhap_thang', 'dti_ratio', 'risk_level',
    'visibility', 'status', 'workflow_steps',
    'created_at', 'updated_at'
}
```

### 10. WORKFLOW STEPS

**ÄÃºng thá»© tá»±:**
1. tiep_nhan
2. phan_loai
3. tu_van
4. xu_ly_ho_so
5. phe_duyet
6. hoan_thanh

---

## KHI Sá»¬A CODE CÅ¨

1. Äá»c `AUDIT_REPORT.md` Section II
2. Sá»­a tá»«ng má»¥c theo thá»© tá»±
3. Test sau má»—i thay Ä‘á»•i
4. Commit vá»›i message rÃµ rÃ ng

## KHI Táº O CODE Má»šI

1. Äá»c `SPECIFICATION.md` Section tÆ°Æ¡ng á»©ng
2. Táº¡o file á»Ÿ Ä‘Ãºng folder
3. Implement Ä‘áº§y Ä‘á»§ error handling
4. ThÃªm test case (náº¿u cÃ³ thá»i gian)
5. Update `requirements.txt` náº¿u dÃ¹ng lib má»›i

## PRIORITIES

ğŸ”´ CAO - LÃ m trÆ°á»›c:
- PhÃ¢n quyá»n & vai trÃ²
- Zalo OA real integration
- OCR CCCD
- Check MST

ğŸŸ¡ TRUNG BÃŒNH - LÃ m sau:
- PhÃ¢n cÃ´ng tá»± Ä‘á»™ng
- TÃ­nh DTI
- BÃ¡o cÃ¡o

ğŸŸ¢ THáº¤P - Optional:
- UI enhancements
- Advanced analytics

---

**Äá»ŒC FILE NÃ€Y Má»–I Láº¦N TRÆ¯á»šC KHI CODE!**
